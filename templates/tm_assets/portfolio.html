{% extends 'common/base.html' %}
{% load static %}

{% block title %}?¨Ìä∏?¥Î¶¨??| Ttiglemoa{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">???¨Ìä∏?¥Î¶¨??/h2>
  <div class="btn-group">
    <a class="btn btn-sm btn-outline-primary" href="{% url 'tm_assets:create_deposit' %}">?àÏ†ÅÍ∏?Ï∂îÍ?</a>
    <a class="btn btn-sm btn-outline-success" href="{% url 'tm_assets:create_stock' %}">Ï£ºÏãù Ï∂îÍ?</a>
    <a class="btn btn-sm btn-outline-secondary" href="{% url 'tm_assets:create_bond' %}">Ï±ÑÍ∂å Ï∂îÍ?</a>
    <a class="btn btn-sm btn-outline-dark" href="{% url 'tm_assets:refresh_prices' %}">Í∞ÄÍ≤??àÎ°úÍ≥†Ïπ®</a>
  </div>
  
</div>

<div class="row g-3 mb-4">
  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header">?êÏÇ∞Íµ??©Í≥Ñ</div>
      <div class="card-body">
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between">
            <span>?ÑÍ∏à???àÏ†ÅÍ∏?</span>
            <strong>{{ class_totals.CASH|floatformat:0 }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Ï£ºÏãù</span>
            <strong>{{ class_totals.STOCK|floatformat:0 }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Ï±ÑÍ∂å</span>
            <strong>{{ class_totals.BOND|floatformat:0 }}</strong>
          </li>
        </ul>
        <small class="text-muted d-block mt-2">Ï∞∏Í≥†: ?µÌôîÍ∞Ä ?ûÏù∏ Í≤ΩÏö∞ ?µÌôîÎ≥??©Í≥ÑÎ•??ÑÎûò?êÏÑú ?ïÏù∏?òÏÑ∏??</small>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header">?µÌôîÎ≥??©Í≥Ñ</div>
      <div class="card-body">
        {% if totals_by_currency %}
          <ul class="list-group">
            {% for currency, total in totals_by_currency.items %}
              <li class="list-group-item d-flex justify-content-between">
                <span>{{ currency }}</span>
                <strong>{{ total|floatformat:0 }}</strong>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mb-0">?±Î°ù???êÏÇ∞???ÜÏäµ?àÎã§.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>?àÏ†ÅÍ∏?/span>
        <a class="btn btn-sm btn-primary" href="{% url 'tm_assets:create_deposit' %}">Ï∂îÍ?</a>
      </div>
      <div class="card-body">
        {% if deposits %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>?Ä??/th>
                  <th>?ÅÌíà</th>
                  <th>?êÍ∏à</th>
                  <th>?¥Ïú®(%)</th>
                  <th>?âÍ?</th>
                  <th>?µÌôî</th>
<!-- Actions ø≠: ∆˜∆Æ∆˙∏Æø¿ø°º≠ ∞¢ ¿⁄ªÍ¿ª πŸ∑Œ ºˆ¡§/ªË¡¶«“ ºˆ ¿÷¥¬ µø¿€ πˆ∆∞¿ª ¡¶∞¯«’¥œ¥Ÿ. -->
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for d in deposits %}
                  <tr>
                    <td>{{ d.bank_name }}</td>
                    <td>{{ d.product_name }} ({{ d.get_product_type_display }})</td>
                    <td>{{ d.principal_amount }}</td>
                    <td>{{ d.annual_rate }}</td>
                    <td>{{ d.estimated_value|floatformat:0 }}</td>
                    <td>{{ d.currency }}</td>
                    <td>
                      <a class="btn btn-sm btn-outline-primary" href="{% comment %}øπ¿˚±› ºˆ¡§ πˆ∆∞{% endcomment %}{% url 'tm_assets:edit_deposit' d.pk %}">Edit</a>
                      <form method="post" {% comment %}øπ¿˚±› ªË¡¶ ∆˚(POST){% endcomment %} action="{% url 'tm_assets:delete_deposit' d.pk %}" class="d-inline">
                        {% csrf_token %}
                        <button class="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('ªË¡¶«œΩ√∞⁄Ω¿¥œ±Ó?' );">Delete</button>
                      </form>
                    </td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted mb-0">?±Î°ù???àÏ†ÅÍ∏àÏù¥ ?ÜÏäµ?àÎã§.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Ï£ºÏãù</span>
        <a class="btn btn-sm btn-success" href="{% url 'tm_assets:create_stock' %}">Ï∂îÍ?</a>
      </div>
      <div class="card-body">
        {% if stocks %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>?úÏû•</th>
                  <th>?∞Ïª§</th>
                  <th>?òÎüâ</th>
                  <th>?®Í?</th>
                  <th>?ÑÏû¨Í∞Ä</th>
                  <th>?âÍ?</th>
                  <th>?µÌôî</th>
<!-- Actions ø≠: ∆˜∆Æ∆˙∏Æø¿ø°º≠ ∞¢ ¿⁄ªÍ¿ª πŸ∑Œ ºˆ¡§/ªË¡¶«“ ºˆ ¿÷¥¬ µø¿€ πˆ∆∞¿ª ¡¶∞¯«’¥œ¥Ÿ. -->
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for s in stocks %}
                  <tr>
                    <td>{{ s.get_market_display }}</td>
                    <td>{{ s.ticker }}</td>
                    <td>{{ s.quantity }}</td>
                    <td>{{ s.average_price }}</td>
                    <td>{{ s.current_price|default:"-" }}</td>
                    <td>{{ s.estimated_value|floatformat:0 }}</td>
                    <td>{{ s.currency }}</td>
                    <td>
                      <a class="btn btn-sm btn-outline-primary" href="{% comment %}¡÷Ωƒ ºˆ¡§ πˆ∆∞{% endcomment %}{% url 'tm_assets:edit_stock' s.pk %}">Edit</a>
                      <form method="post" {% comment %}¡÷Ωƒ ªË¡¶ ∆˚(POST){% endcomment %} action="{% url 'tm_assets:delete_stock' s.pk %}" class="d-inline">
                        {% csrf_token %}
                        <button class="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('ªË¡¶«œΩ√∞⁄Ω¿¥œ±Ó?' );">Delete</button>
                      </form>
                    </td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted mb-0">?±Î°ù??Ï£ºÏãù???ÜÏäµ?àÎã§.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Ï±ÑÍ∂å</span>
        <a class="btn btn-sm btn-secondary" href="{% url 'tm_assets:create_bond' %}">Ï∂îÍ?</a>
      </div>
      <div class="card-body">
        {% if bonds %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>Î™ÖÏπ≠</th>
                  <th>Î∞úÌñâÏ≤?/th>
                  <th>?°Î©¥Ï¥ùÏï°</th>
                  <th>Îß§ÏàòÍ∞Ä(%)</th>
                  <th>?ÑÏû¨Í∞Ä(%)</th>
                  <th>ÎßåÍ∏∞</th>
                  <th>?âÍ?</th>
                  <th>?µÌôî</th>
<!-- Actions ø≠: ∆˜∆Æ∆˙∏Æø¿ø°º≠ ∞¢ ¿⁄ªÍ¿ª πŸ∑Œ ºˆ¡§/ªË¡¶«“ ºˆ ¿÷¥¬ µø¿€ πˆ∆∞¿ª ¡¶∞¯«’¥œ¥Ÿ. -->
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for b in bonds %}
                  <tr>
                    <td>{{ b.name }}</td>
                    <td>{{ b.issuer|default:"-" }}</td>
                    <td>{{ b.face_amount }}</td>
                    <td>{{ b.purchase_price_pct }}</td>
                    <td>{{ b.current_price_pct|default:"-" }}</td>
                    <td>{{ b.maturity_date }}</td>
                    <td>{{ b.estimated_value|floatformat:0 }}</td>
                    <td>{{ b.currency }}</td>
                    <td>
                      <a class="btn btn-sm btn-outline-primary" href="{% comment %}√§±« ºˆ¡§ πˆ∆∞{% endcomment %}{% url 'tm_assets:edit_bond' b.pk %}">Edit</a>
                      <form method="post" {% comment %}√§±« ªË¡¶ ∆˚(POST){% endcomment %} action="{% url 'tm_assets:delete_bond' b.pk %}" class="d-inline">
                        {% csrf_token %}
                        <button class="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('ªË¡¶«œΩ√∞⁄Ω¿¥œ±Ó?' );">Delete</button>
                      </form>
                    </td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted mb-0">?±Î°ù??Ï±ÑÍ∂å???ÜÏäµ?àÎã§.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}






