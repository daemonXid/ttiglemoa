{% extends 'common/base.html' %}
{% load static %}

{% block title %}?ы듃?대━??| Ttiglemoa{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">???ы듃?대━??/h2>
  <div class="btn-group">
    <a class="btn btn-sm btn-outline-primary" href="{% url 'tm_assets:create_deposit' %}">?덉쟻湲?異붽?</a>
    <a class="btn btn-sm btn-outline-success" href="{% url 'tm_assets:create_stock' %}">二쇱떇 異붽?</a>
    <a class="btn btn-sm btn-outline-secondary" href="{% url 'tm_assets:create_bond' %}">梨꾧텒 異붽?</a>
    <a class="btn btn-sm btn-outline-dark" href="{% url 'tm_assets:refresh_prices' %}">媛寃??덈줈怨좎묠</a>
  </div>
  
</div>

<div class="row g-3 mb-4">
  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header">?먯궛援??⑷퀎</div>
      <div class="card-body">
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between">
            <span>?꾧툑???덉쟻湲?</span>
            <strong>{{ class_totals.CASH|floatformat:0 }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>二쇱떇</span>
            <strong>{{ class_totals.STOCK|floatformat:0 }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>梨꾧텒</span>
            <strong>{{ class_totals.BOND|floatformat:0 }}</strong>
          </li>
        </ul>
        <small class="text-muted d-block mt-2">李멸퀬: ?듯솕媛 ?욎씤 寃쎌슦 ?듯솕蹂??⑷퀎瑜??꾨옒?먯꽌 ?뺤씤?섏꽭??</small>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header">?듯솕蹂??⑷퀎</div>
      <div class="card-body">
        {% if totals_by_currency %}
          <ul class="list-group">
            {% for currency, total in totals_by_currency.items %}
              <li class="list-group-item d-flex justify-content-between">
                <span>{{ currency }}</span>
                <strong>{{ total|floatformat:0 }}</strong>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mb-0">?깅줉???먯궛???놁뒿?덈떎.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>?덉쟻湲?/span>
        <a class="btn btn-sm btn-primary" href="{% url 'tm_assets:create_deposit' %}">異붽?</a>
      </div>
      <div class="card-body">
        {% if deposits %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>???/th>
                  <th>?곹뭹</th>
                  <th>?먭툑</th>
                  <th>?댁쑉(%)</th>
                  <th>?됯?</th>
                  <th>?듯솕</th>
<!-- Actions 열: 포트폴리오에서 각 자산을 바로 수정/삭제할 수 있는 동작 버튼을 제공합니다. -->
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for d in deposits %}
                  <tr>
                    <td>{{ d.bank_name }}</td>
                    <td>{{ d.product_name }} ({{ d.get_product_type_display }})</td>
                    <td>{{ d.principal_amount }}</td>
                    <td>{{ d.annual_rate }}</td>
                    <td>{{ d.estimated_value|floatformat:0 }}</td>
                    <td>{{ d.currency }}</td>
                    <td>
                      <a class="btn btn-sm btn-outline-primary" href="{% comment %}예적금 수정 버튼{% endcomment %}{% url 'tm_assets:edit_deposit' d.pk %}">Edit</a>
                      <form method="post" {% comment %}예적금 삭제 폼(POST){% endcomment %} action="{% url 'tm_assets:delete_deposit' d.pk %}" class="d-inline">
                        {% csrf_token %}
                        <button class="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('삭제하시겠습니까?' );">Delete</button>
                      </form>
                    </td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted mb-0">?깅줉???덉쟻湲덉씠 ?놁뒿?덈떎.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>二쇱떇</span>
        <a class="btn btn-sm btn-success" href="{% url 'tm_assets:create_stock' %}">異붽?</a>
      </div>
      <div class="card-body">
        {% if stocks %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>?쒖옣</th>
                  <th>?곗빱</th>
                  <th>?섎웾</th>
                  <th>?④?</th>
                  <th>?꾩옱媛</th>
                  <th>?됯?</th>
                  <th>?듯솕</th>
<!-- Actions 열: 포트폴리오에서 각 자산을 바로 수정/삭제할 수 있는 동작 버튼을 제공합니다. -->
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for s in stocks %}
                  <tr>
                    <td>{{ s.get_market_display }}</td>
                    <td>{{ s.ticker }}</td>
                    <td>{{ s.quantity }}</td>
                    <td>{{ s.average_price }}</td>
                    <td>{{ s.current_price|default:"-" }}</td>
                    <td>{{ s.estimated_value|floatformat:0 }}</td>
                    <td>{{ s.currency }}</td>
                    <td>
                      <a class="btn btn-sm btn-outline-primary" href="{% comment %}주식 수정 버튼{% endcomment %}{% url 'tm_assets:edit_stock' s.pk %}">Edit</a>
                      <form method="post" {% comment %}주식 삭제 폼(POST){% endcomment %} action="{% url 'tm_assets:delete_stock' s.pk %}" class="d-inline">
                        {% csrf_token %}
                        <button class="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('삭제하시겠습니까?' );">Delete</button>
                      </form>
                    </td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted mb-0">?깅줉??二쇱떇???놁뒿?덈떎.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>梨꾧텒</span>
        <a class="btn btn-sm btn-secondary" href="{% url 'tm_assets:create_bond' %}">異붽?</a>
      </div>
      <div class="card-body">
        {% if bonds %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>紐낆묶</th>
                  <th>諛쒗뻾泥?/th>
                  <th>?〓㈃珥앹븸</th>
                  <th>留ㅼ닔媛(%)</th>
                  <th>?꾩옱媛(%)</th>
                  <th>留뚭린</th>
                  <th>?됯?</th>
                  <th>?듯솕</th>
<!-- Actions 열: 포트폴리오에서 각 자산을 바로 수정/삭제할 수 있는 동작 버튼을 제공합니다. -->
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for b in bonds %}
                  <tr>
                    <td>{{ b.name }}</td>
                    <td>{{ b.issuer|default:"-" }}</td>
                    <td>{{ b.face_amount }}</td>
                    <td>{{ b.purchase_price_pct }}</td>
                    <td>{{ b.current_price_pct|default:"-" }}</td>
                    <td>{{ b.maturity_date }}</td>
                    <td>{{ b.estimated_value|floatformat:0 }}</td>
                    <td>{{ b.currency }}</td>
                    <td>
                      <a class="btn btn-sm btn-outline-primary" href="{% comment %}채권 수정 버튼{% endcomment %}{% url 'tm_assets:edit_bond' b.pk %}">Edit</a>
                      <form method="post" {% comment %}채권 삭제 폼(POST){% endcomment %} action="{% url 'tm_assets:delete_bond' b.pk %}" class="d-inline">
                        {% csrf_token %}
                        <button class="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('삭제하시겠습니까?' );">Delete</button>
                      </form>
                    </td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted mb-0">?깅줉??梨꾧텒???놁뒿?덈떎.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}







